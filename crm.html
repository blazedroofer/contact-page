<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roof It - Sales Pipeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #c62828 0%, #8b1a1a 100%);
            color: white;
            padding: 30px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .stats-bar {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 20px;
        }
        
        .stats-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            flex: 1;
            min-width: 200px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }
        
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #c62828;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn:hover {
            background: #8b1a1a;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 12px 12px 45px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
        }
        
        .filter-select {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            cursor: pointer;
            min-width: 200px;
        }
        
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }
        
        .form-container.active {
            display: block;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            font-size: 15px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-secondary {
            background: #757575;
        }
        
        .btn-secondary:hover {
            background: #555;
        }
        
        .leads-list {
            display: grid;
            gap: 15px;
        }
        
        .lead-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #2196F3;
        }
        
        .lead-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .lead-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .lead-address {
            color: #666;
            font-size: 14px;
        }
        
        .lead-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .btn-edit {
            background: #2196F3;
        }
        
        .btn-delete {
            background: #f44336;
        }
        
        .lead-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
            color: #555;
        }
        
        .lead-notes {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .lead-footer {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .stage-badge {
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .empty-state {
            background: white;
            padding: 60px;
            border-radius: 8px;
            text-align: center;
            color: #999;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>Roof It Sales Pipeline</h1>
            <p>Track your leads from first contact to completed job</p>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stats-content">
            <div class="stat-box">
                <div class="stat-label">Total Leads</div>
                <div class="stat-value" style="color: #c62828;" id="totalLeads">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Active Pipeline</div>
                <div class="stat-value" style="color: #FF9800;" id="activeLeads">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Won</div>
                <div class="stat-value" style="color: #00C853;" id="wonLeads">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Pipeline Value</div>
                <div class="stat-value" style="color: #2196F3;" id="pipelineValue">$0</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="controls">
            <button class="btn" onclick="toggleForm()">+ Add New Lead</button>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search leads..." oninput="filterLeads()">
            </div>
            <select class="filter-select" id="stageFilter" onchange="filterLeads()">
                <option value="all">All Stages</option>
                <option value="new">New Lead</option>
                <option value="measured">Measured (Google Earth)</option>
                <option value="quoted">Quote Sent</option>
                <option value="site-visit">Site Visit Scheduled</option>
                <option value="contract">Contract Sent</option>
                <option value="won">Won - Materials Ordered</option>
                <option value="lost">Lost</option>
            </select>
        </div>

        <div class="form-container" id="formContainer">
            <h2 id="formTitle">Add New Lead</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="leadName" required>
                </div>
                <div class="form-group">
                    <label>Address *</label>
                    <input type="text" id="leadAddress" required>
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" id="leadPhone" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="leadEmail">
                </div>
                <div class="form-group">
                    <label>Square Feet</label>
                    <input type="number" id="leadSqft">
                </div>
                <div class="form-group">
                    <label>Pitch</label>
                    <input type="text" id="leadPitch" placeholder="e.g., 6/12">
                </div>
                <div class="form-group">
                    <label>Shingle Layers</label>
                    <select id="leadLayers">
                        <option value="1">1 Layer</option>
                        <option value="2">2 Layers</option>
                        <option value="3">3+ Layers</option>
                        <option value="unknown">Unknown</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estimated Price</label>
                    <input type="number" id="leadPrice">
                </div>
                <div class="form-group">
                    <label>Stage</label>
                    <select id="leadStage">
                        <option value="new">New Lead</option>
                        <option value="measured">Measured (Google Earth)</option>
                        <option value="quoted">Quote Sent</option>
                        <option value="site-visit">Site Visit Scheduled</option>
                        <option value="contract">Contract Sent</option>
                        <option value="won">Won - Materials Ordered</option>
                        <option value="lost">Lost</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Follow-up Date</label>
                    <input type="date" id="leadFollowUp">
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Notes</label>
                    <textarea id="leadNotes" rows="3"></textarea>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn" onclick="saveLead()">Save Lead</button>
                <button class="btn btn-secondary" onclick="cancelForm()">Cancel</button>
            </div>
        </div>

        <div class="leads-list" id="leadsList"></div>
    </div>

    <script>
        const stages = {
            'new': { name: 'New Lead', color: '#2196F3' },
            'measured': { name: 'Measured (Google Earth)', color: '#FF9800' },
            'quoted': { name: 'Quote Sent', color: '#9C27B0' },
            'site-visit': { name: 'Site Visit Scheduled', color: '#F44336' },
            'contract': { name: 'Contract Sent', color: '#4CAF50' },
            'won': { name: 'Won - Materials Ordered', color: '#00C853' },
            'lost': { name: 'Lost', color: '#757575' }
        };

        let leads = [];
        let editingId = null;

        function loadLeads() {
            const saved = localStorage.getItem('roofItLeads');
            if (saved) {
                leads = JSON.parse(saved);
            }
            renderLeads();
            updateStats();
        }

        function saveLeads() {
            localStorage.setItem('roofItLeads', JSON.stringify(leads));
        }

        function toggleForm() {
            const form = document.getElementById('formContainer');
            form.classList.toggle('active');
            if (form.classList.contains('active')) {
                resetForm();
            }
        }

        function resetForm() {
            editingId = null;
            document.getElementById('formTitle').textContent = 'Add New Lead';
            document.getElementById('leadName').value = '';
            document.getElementById('leadAddress').value = '';
            document.getElementById('leadPhone').value = '';
            document.getElementById('leadEmail').value = '';
            document.getElementById('leadSqft').value = '';
            document.getElementById('leadPitch').value = '';
            document.getElementById('leadLayers').value = '1';
            document.getElementById('leadPrice').value = '';
            document.getElementById('leadStage').value = 'new';
            document.getElementById('leadFollowUp').value = '';
            document.getElementById('leadNotes').value = '';
        }

        function cancelForm() {
            document.getElementById('formContainer').classList.remove('active');
            resetForm();
        }

        function saveLead() {
            const name = document.getElementById('leadName').value;
            const address = document.getElementById('leadAddress').value;
            const phone = document.getElementById('leadPhone').value;

            if (!name || !address || !phone) {
                alert('Please fill in name, address, and phone');
                return;
            }

            const lead = {
                id: editingId || Date.now().toString(),
                name,
                address,
                phone,
                email: document.getElementById('leadEmail').value,
                sqft: document.getElementById('leadSqft').value,
                pitch: document.getElementById('leadPitch').value,
                layers: document.getElementById('leadLayers').value,
                estimatedPrice: document.getElementById('leadPrice').value,
                stage: document.getElementById('leadStage').value,
                followUpDate: document.getElementById('leadFollowUp').value,
                notes: document.getElementById('leadNotes').value,
                dateAdded: new Date().toISOString().split('T')[0]
            };

            if (editingId) {
                const index = leads.findIndex(l => l.id === editingId);
                leads[index] = lead;
            } else {
                leads.unshift(lead);
            }

            saveLeads();
            renderLeads();
            updateStats();
            cancelForm();
        }

        function editLead(id) {
            const lead = leads.find(l => l.id === id);
            if (!lead) return;

            editingId = id;
            document.getElementById('formTitle').textContent = 'Edit Lead';
            document.getElementById('leadName').value = lead.name;
            document.getElementById('leadAddress').value = lead.address;
            document.getElementById('leadPhone').value = lead.phone;
            document.getElementById('leadEmail').value = lead.email || '';
            document.getElementById('leadSqft').value = lead.sqft || '';
            document.getElementById('leadPitch').value = lead.pitch || '';
            document.getElementById('leadLayers').value = lead.layers || '1';
            document.getElementById('leadPrice').value = lead.estimatedPrice || '';
            document.getElementById('leadStage').value = lead.stage;
            document.getElementById('leadFollowUp').value = lead.followUpDate || '';
            document.getElementById('leadNotes').value = lead.notes || '';
            
            document.getElementById('formContainer').classList.add('active');
        }

        function deleteLead(id) {
            if (confirm('Are you sure you want to delete this lead?')) {
                leads = leads.filter(l => l.id !== id);
                saveLeads();
                renderLeads();
                updateStats();
            }
        }

        function updateStage(id, newStage) {
            const lead = leads.find(l => l.id === id);
            if (lead) {
                lead.stage = newStage;
                saveLeads();
                renderLeads();
                updateStats();
            }
        }

        function filterLeads() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const stageFilter = document.getElementById('stageFilter').value;

            let filtered = leads;

            if (stageFilter !== 'all') {
                filtered = filtered.filter(l => l.stage === stageFilter);
            }

            if (search) {
                filtered = filtered.filter(l => 
                    l.name.toLowerCase().includes(search) ||
                    l.address.toLowerCase().includes(search) ||
                    l.phone.includes(search)
                );
            }

            renderLeads(filtered);
        }

        function renderLeads(leadsToRender = leads) {
            const container = document.getElementById('leadsList');
            
            if (leadsToRender.length === 0) {
                container.innerHTML = '<div class="empty-state"><p style="font-size: 18px;">No leads found. Add your first lead to get started!</p></div>';
                return;
            }

            container.innerHTML = leadsToRender.map(lead => `
                <div class="lead-card" style="border-left-color: ${stages[lead.stage].color}">
                    <div class="lead-header">
                        <div>
                            <div class="lead-name">${lead.name}</div>
                            <div class="lead-address">üìç ${lead.address}</div>
                        </div>
                        <div class="lead-actions">
                            <button class="btn btn-small btn-edit" onclick="editLead('${lead.id}')">Edit</button>
                            <button class="btn btn-small btn-delete" onclick="deleteLead('${lead.id}')">Delete</button>
                        </div>
                    </div>
                    <div class="lead-details">
                        ${lead.phone ? `<div>üìû ${lead.phone}</div>` : ''}
                        ${lead.email ? `<div>‚úâÔ∏è ${lead.email}</div>` : ''}
                        ${lead.sqft ? `<div><strong>Sq Ft:</strong> ${lead.sqft}</div>` : ''}
                        ${lead.pitch ? `<div><strong>Pitch:</strong> ${lead.pitch}</div>` : ''}
                        ${lead.layers ? `<div><strong>Layers:</strong> ${lead.layers}</div>` : ''}
                        ${lead.estimatedPrice ? `<div>üí∞ $${parseFloat(lead.estimatedPrice).toLocaleString()}</div>` : ''}
                        ${lead.followUpDate ? `<div>üìÖ Follow-up: ${lead.followUpDate}</div>` : ''}
                    </div>
                    ${lead.notes ? `<div class="lead-notes"><strong>Notes:</strong> ${lead.notes}</div>` : ''}
                    <div class="lead-footer">
                        <div class="stage-badge" style="background: ${stages[lead.stage].color}">
                            ${stages[lead.stage].name}
                        </div>
                        <select class="filter-select" onchange="updateStage('${lead.id}', this.value)" style="padding: 6px 12px; font-size: 13px; min-width: auto;">
                            <option value="">Move to...</option>
                            ${Object.keys(stages).map(key => `<option value="${key}">${stages[key].name}</option>`).join('')}
                        </select>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            const total = leads.length;
            const active = leads.filter(l => l.stage !== 'won' && l.stage !== 'lost').length;
            const won = leads.filter(l => l.stage === 'won').length;
            const value = leads
                .filter(l => l.stage !== 'lost' && l.estimatedPrice)
                .reduce((sum, l) => sum + parseFloat(l.estimatedPrice || 0), 0);

            document.getElementById('totalLeads').textContent = total;
            document.getElementById('activeLeads').textContent = active;
            document.getElementById('wonLeads').textContent = won;
            document.getElementById('pipelineValue').textContent = '$' + value.toLocaleString();
        }

        loadLeads();
    </script>
</body>
</html>
